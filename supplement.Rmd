---
title: "Online supplement for the paper 'Frequency and character complexity in 27 writing systems'"
author: "Alexey Koshevoy, Helena Miton and Olivier Morin"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
# bibliography: biblio.bib
---



```{r setup, include=FALSE, echo=FALSE}

knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning = FALSE)


library(ggplot2)
library(dplyr)
library(lme4)
library(lmerTest)
library(sjPlot) 
library(effects)
library(showtext)
library(ggeffects)
library(ggpubr)
library(ggrepel)
library(MuMIn)
library(Cairo)
library(sysfonts)
library(broom.mixed)
library(viridis)
library(equatiomatic)
library(gtsummary)

# Setting the theme for ggplot
theme_set(theme_bw())
# Data loading
data <- read.csv('data/final.csv')
data <- data[data$ISO_language != 'heb',]
## Log-transforming relative frequency
data$Relative_frequency_l <- log(data$Relative_frequency)

# Mixed-effects linear regression
## Perimetric complexity models (full and null)
model_full_p <- lmer(formula = Perimetric_complexity ~ 1 + Relative_frequency_l
                     + (1 + Relative_frequency_l|ISO_script), data=data)
model_null_p <- lmer(formula =Perimetric_complexity ~ 1 + (1|ISO_script), 
                     data=data)

## Algorithmic complexity models (full and null)
model_full_c <- lmer(formula = Compression ~ 1 + Relative_frequency_l +
                       (1 + Relative_frequency_l|ISO_script), data=data)
model_null_c <- lmer(formula =Compression ~ 1 + (1|ISO_script), data=data)
```



# 1. Data

Relative frequency density plot before and after log-scaling:

```{r}
nlog <- ggplot(data, aes(x=Relative_frequency))+
  theme(legend.position = "none")+
  geom_histogram(aes(y = ..density..), bins=50)+
  geom_density(color='red', lwd=1)+
  # ggtitle('Initial frequencies')+
  xlab('Relative frequency')+
  ylab('Density')

log <- ggplot(data, aes(x=log(Relative_frequency)))+
  theme(legend.position = "none")+
  geom_histogram(aes(y = ..density..), bins=50)+
  geom_density(color='red', lwd=1)+
  # ggtitle('Log-transformed frequencies')+
  xlab('Relative frequency (log-transformed)')+
  ylab('Density')

ggarrange(nlog, log)
```

Individual distribution for each script: 

```{r}
ggplot(data, aes(x=log(Relative_frequency), color=ISO_script))+
  theme(legend.position = "none")+
  geom_histogram(aes(y = ..density..), bins=20)+
  geom_density(color='red', lwd=0.5)+
  facet_wrap(~ISO_script, scale='free_y')+
  scale_color_viridis(discrete=TRUE)+
  xlab('Relative frequency (log-transformed)')+
  ylab('Density')
```

Pearson correlations of each complexity measures for each script:

```{r}
ggplot(data, aes(x=Perimetric_complexity, y=Compression))+
  theme(legend.position = "none")+
  geom_point(size=0.5, aes(color=ISO_script))+
  facet_wrap(~ISO_script)+
  scale_fill_viridis(discrete=TRUE)+
  stat_cor(aes(label = paste(..r.label..)), 
           color = "black", 
           geom = "text",
           label.y.npc="top",
           label.x.npc = "left", 
           method = "pearson",
           size=2.5)+
  ylab('Algorithmic complexity')+
  xlab('Perimetric complexity')
```


# 2. Mixed effects models 

## 2.1. Perimetric complexity model

Model formula: 

```{r}
equatiomatic::extract_eq(model_full_p, wrap = TRUE, terms_per_line = 2)
```


Model coefficients:

```{r}
tbl_regression(model_full_p, exponentiate = FALSE)

```

The formula above with the coefficients plugged in:

```{r}
equatiomatic::extract_eq(model_full_p, wrap = TRUE, terms_per_line = 2, use_coefs = TRUE)
```

Quantile-quantile plot: 

```{r}
qqnorm(residuals(model_full_p))
```

Residuals: 

```{r}
p1 <- ggplot(data.frame(x=log(data$Relative_frequency),pearson=residuals(model_full_p,type="pearson")),
    aes(x=x,y=pearson)) +
    geom_point(alpha=1, color='grey')+
    theme_bw()+
    xlab('Relative frequency')+
    geom_hline(yintercept=0,linetype="dashed")+
    ylim(-50, 50)+
    ylab('Residuals')

p2 <- ggplot(data.frame(pearson=residuals(model_full_p,type="pearson")), aes(x=pearson))+
  geom_histogram(aes(y = ..density..), bins=50, color='grey', fill='grey')+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  xlim(-50, 50)+
  coord_flip()+
  ylab('Density')

ggarrange(p1, p2, widths = c(1, 0.5), ncol = 2, nrow = 1)
```


## 2.2. Algorithmic complexity model

Model formula: 

```{r}
equatiomatic::extract_eq(model_full_c, wrap = TRUE, terms_per_line = 2)
```


Model coefficients:

```{r}
tbl_regression(model_full_c, exponentiate = FALSE)

```

The formula above with the coefficients plugged in:

```{r}
equatiomatic::extract_eq(model_full_c, wrap = TRUE, terms_per_line = 2, use_coefs = TRUE)
```

Quantile-quantile plot: 

```{r}
qqnorm(residuals(model_full_c))
```

Residuals: 

```{r}
p1 <- ggplot(data.frame(x=log(data$Relative_frequency),pearson=residuals(model_full_c,type="pearson")),
    aes(x=x,y=pearson)) +
    geom_point(alpha=1, color='grey')+
    theme_bw()+
    xlab('Relative frequency')+
    geom_hline(yintercept=0,linetype="dashed")+
    ylim(-700, 700)+
    ylab('Residuals')

p2 <- ggplot(data.frame(pearson=residuals(model_full_c,type="pearson")), aes(x=pearson))+
  geom_histogram(aes(y = ..density..), bins=50, color='grey', fill='grey')+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  xlim(-700, 700)+
  coord_flip()+
  ylab('Density')

ggarrange(p1, p2, widths = c(1, 0.5), ncol = 2, nrow = 1)
```

